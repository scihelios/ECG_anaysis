import numpy as np
import os
import json
from sklearn.model_selection import train_test_split

# LMS Filter Class
import torch
import torch.nn as nn
import torch.optim as optim

class MLPModel(nn.Module):
    def __init__(self):
        super(MLPModel, self).__init__()
        self.fc1 = nn.Linear(64, 32)  # Adjust the input size to match the window size
        self.fc2 = nn.Linear(32, 8)
        self.fc3 = nn.Linear(8, 1)
        self.relu = nn.ReLU()

    def forward(self, x):
        x = self.relu(self.fc1(x))
        x = self.relu(self.fc2(x))
        return self.fc3(x)
device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
print("Using device:", device)
def load_data(folder_path, window_size):
    all_sequences = []
    all_targets = []
    k=0
    for file_name in os.listdir(folder_path):
        if file_name.startswith('signal') and file_name.endswith('.json') and k<100:
            print(file_name)
            k+=1
            with open(os.path.join(folder_path, file_name), 'r') as file:
                data = json.load(file)
                long_sequence = data["signal"]
                for i in range(len(long_sequence) - window_size):
                    window = long_sequence[i:i + window_size]
                    next_point = long_sequence[i + window_size]
                    all_sequences.append(window)
                    all_targets.append(next_point)

    return np.array(all_sequences), np.array(all_targets)

window_size = 64
inputs, targets = load_data('C:/Users/ahmed mansour/Desktop/scolarite X/2A/Psc/ECG_anaysis/for_lsm', window_size)
inputs_tensor = torch.tensor(inputs, dtype=torch.float32)
targets_tensor = torch.tensor(targets, dtype=torch.float32)

# Split the data into training and validation sets
train_sequences, val_sequences, train_labels, val_labels = train_test_split(
    inputs_tensor, targets_tensor, test_size=0.25, random_state=42)

# Initialize the model, loss function, and optimizer
model = MLPModel().to(device)  # Move model to GPU
criterion = nn.MSELoss()
optimizer = optim.Adam(model.parameters(), lr=0.001)

# Training loop
num_epochs = 400  # Adjust as necessary
from torch.utils.data import DataLoader, TensorDataset

# Create TensorDataset and DataLoader for batch processing
train_dataset = TensorDataset(train_sequences, train_labels)
val_dataset = TensorDataset(val_sequences, val_labels)

batch_size = 4096  # You can adjust this based on your memory capacity
train_loader = DataLoader(train_dataset, batch_size=batch_size, shuffle=True)
val_loader = DataLoader(val_dataset, batch_size=batch_size, shuffle=False)

# Training loop
for epoch in range(num_epochs):
    model.train()
    total_loss = 0
    for batch in train_loader:
        inputs, targets = batch[0].to(device), batch[1].to(device)
        optimizer.zero_grad()
        outputs = model(inputs)
        loss = criterion(outputs, targets)
        loss.backward()
        optimizer.step()
        total_loss += loss.item()

    print(f"Epoch {epoch + 1}/{num_epochs}, Training Loss: {total_loss / len(train_loader)}")

    # Validation step
    model.eval()
    val_losses = []
    with torch.no_grad():
        for batch in val_loader:
            inputs, targets = batch[0].to(device), batch[1].to(device)  # Move data to GPU
            outputs = model(inputs)
            val_loss = criterion(outputs, targets)
            val_losses.append(val_loss.item())
            
    avg_val_loss = np.mean(val_losses)
    print(f"Validation Loss: {avg_val_loss:.4f}")

def iterative_forecast(initial_data, model, steps):
    """
    Predict future points iteratively using the MLP model.

    :param initial_data: List of initial 1600 points.
    :param model: Trained MLP model.
    :param steps: Number of future points to predict.
    :return: List containing the initial data followed by the predicted points.
    """
    data = initial_data.copy()
    model.eval()  # Set the model to evaluation mode

    with torch.no_grad():
        for _ in range(steps):
            # Use the latest 1600 points for prediction
            current_input = torch.tensor(data[-64:], dtype=torch.float32)
            current_input = current_input.unsqueeze(0)  # Add batch dimension
            current_input = current_input.to(device) 
            prediction = model(current_input)
            next_point = prediction.squeeze().item()  # Convert tensor to scalar
            data.append(next_point)

    return data


import matplotlib.pyplot as plt
# Assuming `lms_filter` is your trained LMS filter
# And `initial_points` is your list of initial 400 points
initial_points = [0.04201680672268908, 0.03361344537815126, 0.03361344537815126, 0.025210084033613446, 0.01680672268907563, 0.0, -0.008403361344537815, -0.025210084033613446, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.058823529411764705, -0.058823529411764705, -0.05042016806722689, -0.05042016806722689, -0.04201680672268908, -0.03361344537815126, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.03361344537815126, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.05042016806722689, -0.04201680672268908, -0.04201680672268908, -0.03361344537815126, -0.025210084033613446, -0.01680672268907563, -0.01680672268907563, -0.008403361344537815, -0.01680672268907563, -0.01680672268907563, -0.01680672268907563, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.01680672268907563, -0.01680672268907563, -0.01680672268907563, -0.025210084033613446, -0.03361344537815126, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.04201680672268908, -0.03361344537815126, -0.025210084033613446, -0.01680672268907563, 0.0, 0.008403361344537815, 0.025210084033613446, 0.03361344537815126, 0.04201680672268908, 0.04201680672268908, 0.03361344537815126, 0.025210084033613446, 0.01680672268907563, 0.008403361344537815, 0.0, 0.0, 0.01680672268907563, 0.03361344537815126, 0.05042016806722689, 0.07563025210084033, 0.10084033613445378, 0.1092436974789916, 0.11764705882352941, 0.1092436974789916, 0.09243697478991597, 0.06722689075630252, 0.04201680672268908, 0.01680672268907563, 0.0, -0.01680672268907563, -0.025210084033613446, -0.025210084033613446, -0.03361344537815126, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.06722689075630252, -0.08403361344537816, -0.10084033613445378, -0.1092436974789916, -0.11764705882352941, -0.12605042016806722, -0.12605042016806722, -0.11764705882352941, -0.10084033613445378, -0.09243697478991597, -0.07563025210084033, -0.06722689075630252, -0.058823529411764705, -0.06722689075630252, -0.06722689075630252, -0.08403361344537816, -0.10084033613445378, -0.11764705882352941, -0.13445378151260504, -0.14285714285714285, -0.14285714285714285, -0.14285714285714285, -0.12605042016806722, -0.11764705882352941, -0.10084033613445378, -0.09243697478991597, -0.09243697478991597, -0.09243697478991597, -0.10084033613445378, -0.11764705882352941, -0.12605042016806722, -0.13445378151260504, -0.13445378151260504, -0.12605042016806722, -0.11764705882352941, -0.10084033613445378, -0.09243697478991597, -0.08403361344537816, -0.08403361344537816, -0.09243697478991597, -0.10084033613445378, -0.11764705882352941, -0.12605042016806722, -0.13445378151260504, -0.13445378151260504, -0.13445378151260504, -0.12605042016806722, -0.12605042016806722, -0.11764705882352941, -0.11764705882352941, -0.11764705882352941, -0.11764705882352941, -0.11764705882352941, -0.1092436974789916, -0.10084033613445378, -0.07563025210084033, -0.05042016806722689, -0.01680672268907563, 0.01680672268907563, 0.058823529411764705, 0.1092436974789916, 0.16806722689075632, 0.24369747899159663, 0.33613445378151263, 0.44537815126050423, 0.5630252100840336, 0.6890756302521008, 0.7983193277310925, 0.8823529411764706, 0.9243697478991597, 0.9159663865546218, 0.8403361344537815, 0.7058823529411765, 0.5210084033613446, 0.31092436974789917, 0.09243697478991597, -0.1092436974789916, -0.2773109243697479, -0.3865546218487395, -0.453781512605042, -0.46218487394957986, -0.42857142857142855, -0.3697478991596639, -0.29411764705882354, -0.226890756302521, -0.15966386554621848, -0.12605042016806722, -0.10084033613445378, -0.09243697478991597, -0.09243697478991597, -0.10084033613445378, -0.1092436974789916, -0.1092436974789916, -0.1092436974789916, -0.10084033613445378, -0.09243697478991597, -0.08403361344537816, -0.07563025210084033, -0.07563025210084033, -0.07563025210084033, -0.07563025210084033, -0.08403361344537816, -0.08403361344537816, -0.08403361344537816, -0.08403361344537816, -0.07563025210084033, -0.06722689075630252, -0.058823529411764705, -0.058823529411764705, -0.05042016806722689, -0.05042016806722689, -0.058823529411764705, -0.058823529411764705, -0.058823529411764705, -0.06722689075630252, -0.06722689075630252, -0.06722689075630252, -0.058823529411764705, -0.05042016806722689, -0.04201680672268908, -0.03361344537815126, -0.025210084033613446, -0.01680672268907563, -0.008403361344537815, -0.008403361344537815, -0.008403361344537815, -0.01680672268907563, -0.025210084033613446, -0.04201680672268908, -0.05042016806722689, -0.058823529411764705, -0.06722689075630252, -0.06722689075630252, -0.05042016806722689, -0.03361344537815126, -0.01680672268907563, 0.008403361344537815, 0.025210084033613446, 0.04201680672268908, 0.04201680672268908, 0.04201680672268908, 0.03361344537815126, 0.025210084033613446, 0.01680672268907563, 0.008403361344537815, 0.008403361344537815, 0.01680672268907563, 0.03361344537815126, 0.058823529411764705, 0.08403361344537816, 0.10084033613445378, 0.11764705882352941, 0.12605042016806722, 0.13445378151260504, 0.14285714285714285, 0.14285714285714285, 0.14285714285714285, 0.15126050420168066, 0.15126050420168066, 0.15966386554621848, 0.17647058823529413, 0.18487394957983194, 0.19327731092436976, 0.21008403361344538, 0.2184873949579832, 0.226890756302521, 0.24369747899159663, 0.2605042016806723, 0.2773109243697479, 0.29411764705882354, 0.31092436974789917, 0.31932773109243695, 0.3277310924369748, 0.33613445378151263, 0.33613445378151263, 0.33613445378151263, 0.33613445378151263, 0.3445378151260504, 0.35294117647058826, 0.3697478991596639, 0.3865546218487395, 0.3949579831932773, 0.40336134453781514, 0.40336134453781514, 0.3949579831932773, 0.37815126050420167, 0.3445378151260504, 0.31092436974789917, 0.2857142857142857, 0.25210084033613445, 0.23529411764705882, 0.226890756302521, 0.226890756302521, 0.226890756302521, 0.23529411764705882, 0.23529411764705882, 0.23529411764705882, 0.2184873949579832, 0.19327731092436976, 0.15966386554621848, 0.12605042016806722, 0.09243697478991597, 0.06722689075630252, 0.04201680672268908, 0.025210084033613446, 0.01680672268907563, 0.01680672268907563, 0.008403361344537815, 0.008403361344537815, 0.0, -0.008403361344537815, -0.025210084033613446, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.04201680672268908, -0.04201680672268908, -0.03361344537815126, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.03361344537815126, -0.04201680672268908, -0.058823529411764705, -0.06722689075630252, -0.06722689075630252, -0.06722689075630252, -0.058823529411764705, -0.05042016806722689, -0.04201680672268908, -0.03361344537815126, -0.03361344537815126, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.058823529411764705, -0.06722689075630252, -0.07563025210084033, -0.07563025210084033, -0.07563025210084033, -0.06722689075630252, -0.06722689075630252, -0.06722689075630252, -0.06722689075630252, -0.06722689075630252, -0.06722689075630252, -0.058823529411764705, -0.05042016806722689, -0.04201680672268908, -0.025210084033613446, -0.008403361344537815, 0.0, 0.0, 0.0, -0.01680672268907563, -0.03361344537815126, -0.04201680672268908, -0.058823529411764705, -0.058823529411764705, -0.058823529411764705, -0.05042016806722689, -0.03361344537815126, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.03361344537815126, -0.05042016806722689, -0.06722689075630252, -0.08403361344537816, -0.09243697478991597, -0.09243697478991597, -0.08403361344537816, -0.06722689075630252, -0.05042016806722689, -0.03361344537815126, -0.01680672268907563, -0.008403361344537815, 0.0, 0.0, 0.0, -0.008403361344537815, -0.01680672268907563, -0.01680672268907563, -0.025210084033613446, -0.03361344537815126, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.04201680672268908, -0.04201680672268908, -0.04201680672268908, -0.05042016806722689, -0.058823529411764705, -0.06722689075630252, -0.08403361344537816, -0.10084033613445378, -0.1092436974789916, -0.1092436974789916, -0.10084033613445378, -0.09243697478991597, -0.07563025210084033, -0.058823529411764705, -0.04201680672268908, -0.03361344537815126, -0.03361344537815126, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.058823529411764705, -0.06722689075630252, -0.07563025210084033, -0.08403361344537816, -0.08403361344537816, -0.07563025210084033, -0.06722689075630252, -0.058823529411764705, -0.05042016806722689, -0.04201680672268908, -0.04201680672268908, -0.03361344537815126, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.058823529411764705, -0.06722689075630252, -0.07563025210084033, -0.07563025210084033, -0.07563025210084033, -0.06722689075630252, -0.058823529411764705, -0.04201680672268908, -0.025210084033613446, 0.0, 0.008403361344537815, 0.025210084033613446, 0.025210084033613446, 0.025210084033613446, 0.01680672268907563, 0.008403361344537815, -0.008403361344537815, -0.008403361344537815, -0.008403361344537815, -0.008403361344537815, 0.0, 0.01680672268907563, 0.03361344537815126, 0.04201680672268908, 0.05042016806722689, 0.05042016806722689, 0.04201680672268908, 0.025210084033613446, 0.0, -0.01680672268907563, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.058823529411764705, -0.058823529411764705, -0.06722689075630252, -0.06722689075630252, -0.07563025210084033, -0.08403361344537816, -0.09243697478991597, -0.10084033613445378, -0.10084033613445378, -0.10084033613445378, -0.10084033613445378, -0.09243697478991597, -0.09243697478991597, -0.08403361344537816, -0.09243697478991597, -0.09243697478991597, -0.10084033613445378, -0.1092436974789916, -0.11764705882352941, -0.12605042016806722, -0.13445378151260504, -0.14285714285714285, -0.14285714285714285, -0.14285714285714285, -0.14285714285714285, -0.14285714285714285, -0.15126050420168066, -0.15966386554621848, -0.15966386554621848, -0.16806722689075632, -0.16806722689075632, -0.17647058823529413, -0.16806722689075632, -0.16806722689075632, -0.15966386554621848, -0.15126050420168066, -0.15126050420168066, -0.14285714285714285, -0.13445378151260504, -0.13445378151260504, -0.12605042016806722, -0.11764705882352941, -0.11764705882352941, -0.1092436974789916, -0.10084033613445378, -0.10084033613445378, -0.09243697478991597, -0.09243697478991597, -0.09243697478991597, -0.09243697478991597, -0.1092436974789916, -0.11764705882352941, -0.14285714285714285, -0.15966386554621848, -0.17647058823529413, -0.18487394957983194, -0.18487394957983194, -0.16806722689075632, -0.14285714285714285, -0.10084033613445378, -0.04201680672268908, 0.025210084033613446, 0.11764705882352941, 0.21008403361344538, 0.31932773109243695, 0.4369747899159664, 0.5546218487394958, 0.6722689075630253, 0.773109243697479, 0.8487394957983193, 0.8907563025210085, 0.8823529411764706, 0.8151260504201681, 0.7058823529411765, 0.5378151260504201, 0.3445378151260504, 0.14285714285714285, -0.058823529411764705, -0.23529411764705882, -0.36134453781512604, -0.44537815126050423, -0.47058823529411764, -0.453781512605042, -0.40336134453781514, -0.33613445378151263, -0.2773109243697479, -0.226890756302521, -0.19327731092436976, -0.17647058823529413, -0.17647058823529413, -0.18487394957983194, -0.19327731092436976, -0.20168067226890757, -0.19327731092436976, -0.17647058823529413, -0.15966386554621848, -0.13445378151260504, -0.11764705882352941, -0.1092436974789916, -0.10084033613445378, -0.10084033613445378, -0.10084033613445378, -0.09243697478991597, -0.08403361344537816, -0.07563025210084033, -0.06722689075630252, -0.058823529411764705, -0.05042016806722689, -0.05042016806722689, -0.058823529411764705, -0.07563025210084033, -0.09243697478991597, -0.10084033613445378, -0.1092436974789916, -0.1092436974789916, -0.10084033613445378, -0.09243697478991597, -0.07563025210084033, -0.058823529411764705, -0.04201680672268908, -0.03361344537815126, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.05042016806722689, -0.058823529411764705, -0.06722689075630252, -0.06722689075630252, -0.06722689075630252, -0.07563025210084033, -0.07563025210084033, -0.08403361344537816, -0.08403361344537816, -0.09243697478991597, -0.08403361344537816, -0.07563025210084033, -0.06722689075630252, -0.05042016806722689, -0.03361344537815126, -0.025210084033613446, -0.01680672268907563, -0.008403361344537815, 0.0, 0.008403361344537815, 0.01680672268907563, 0.025210084033613446, 0.03361344537815126, 0.05042016806722689, 0.058823529411764705, 0.058823529411764705, 0.058823529411764705, 0.058823529411764705, 0.05042016806722689, 0.05042016806722689, 0.05042016806722689, 0.058823529411764705, 0.06722689075630252, 0.09243697478991597, 0.11764705882352941, 0.14285714285714285, 0.15966386554621848, 0.17647058823529413, 0.18487394957983194, 0.18487394957983194, 0.18487394957983194, 0.19327731092436976, 0.20168067226890757, 0.2184873949579832, 0.23529411764705882, 0.2605042016806723, 0.2857142857142857, 0.3025210084033613, 0.3277310924369748, 0.33613445378151263, 0.3445378151260504, 0.35294117647058826, 0.35294117647058826, 0.3445378151260504, 0.3445378151260504, 0.33613445378151263, 0.33613445378151263, 0.3277310924369748, 0.3277310924369748, 0.3277310924369748, 0.33613445378151263, 0.33613445378151263, 0.3445378151260504, 0.35294117647058826, 0.35294117647058826, 0.35294117647058826, 0.33613445378151263, 0.31092436974789917, 0.2857142857142857, 0.24369747899159663, 0.21008403361344538, 0.16806722689075632, 0.14285714285714285, 0.12605042016806722, 0.11764705882352941, 0.11764705882352941, 0.11764705882352941, 0.11764705882352941, 0.11764705882352941, 0.1092436974789916, 0.09243697478991597, 0.06722689075630252, 0.04201680672268908, 0.01680672268907563, 0.0, -0.008403361344537815, -0.01680672268907563, -0.01680672268907563, -0.008403361344537815, -0.008403361344537815, -0.008403361344537815, -0.01680672268907563, -0.025210084033613446, -0.04201680672268908, -0.058823529411764705, -0.07563025210084033, -0.08403361344537816, -0.09243697478991597, -0.08403361344537816, -0.07563025210084033, -0.06722689075630252, -0.05042016806722689, -0.03361344537815126, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.03361344537815126, -0.05042016806722689, -0.058823529411764705, -0.07563025210084033, -0.08403361344537816, -0.08403361344537816, -0.07563025210084033, -0.06722689075630252, -0.058823529411764705, -0.05042016806722689, -0.04201680672268908, -0.04201680672268908, -0.04201680672268908, -0.05042016806722689, -0.06722689075630252, -0.07563025210084033, -0.09243697478991597, -0.09243697478991597, -0.10084033613445378, -0.09243697478991597, -0.08403361344537816, -0.07563025210084033, -0.06722689075630252, -0.058823529411764705, -0.058823529411764705, -0.058823529411764705, -0.058823529411764705, -0.058823529411764705, -0.058823529411764705, -0.058823529411764705, -0.05042016806722689, -0.04201680672268908, -0.03361344537815126, -0.03361344537815126, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.03361344537815126, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.058823529411764705, -0.06722689075630252, -0.07563025210084033, -0.08403361344537816, -0.09243697478991597, -0.09243697478991597, -0.08403361344537816, -0.07563025210084033, -0.058823529411764705, -0.05042016806722689, -0.03361344537815126, -0.01680672268907563, -0.01680672268907563, -0.01680672268907563, -0.025210084033613446, -0.03361344537815126, -0.05042016806722689, -0.058823529411764705, -0.06722689075630252, -0.07563025210084033, -0.07563025210084033, -0.06722689075630252, -0.058823529411764705, -0.05042016806722689, -0.04201680672268908, -0.03361344537815126, -0.025210084033613446, -0.025210084033613446, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.058823529411764705, -0.06722689075630252, -0.07563025210084033, -0.07563025210084033, -0.07563025210084033, -0.07563025210084033, -0.06722689075630252, -0.058823529411764705, -0.05042016806722689, -0.05042016806722689, -0.04201680672268908, -0.04201680672268908, -0.04201680672268908, -0.05042016806722689, -0.05042016806722689, -0.058823529411764705, -0.058823529411764705, -0.06722689075630252, -0.06722689075630252, -0.07563025210084033, -0.07563025210084033, -0.08403361344537816, -0.09243697478991597, -0.10084033613445378, -0.10084033613445378, -0.10084033613445378, -0.09243697478991597, -0.08403361344537816, -0.07563025210084033, -0.058823529411764705, -0.04201680672268908, -0.04201680672268908, -0.04201680672268908, -0.05042016806722689, -0.07563025210084033, -0.09243697478991597, -0.11764705882352941, -0.12605042016806722, -0.12605042016806722, -0.1092436974789916, -0.08403361344537816, -0.05042016806722689, -0.01680672268907563, 0.008403361344537815, 0.025210084033613446, 0.025210084033613446, 0.01680672268907563, -0.008403361344537815, -0.04201680672268908, -0.06722689075630252, -0.08403361344537816, -0.09243697478991597, -0.09243697478991597, -0.07563025210084033, -0.05042016806722689, -0.03361344537815126, -0.01680672268907563, -0.01680672268907563, -0.01680672268907563, -0.025210084033613446, -0.03361344537815126, -0.03361344537815126, -0.03361344537815126, -0.01680672268907563, 0.0, 0.025210084033613446, 0.05042016806722689, 0.06722689075630252, 0.07563025210084033, 0.07563025210084033, 0.058823529411764705, 0.03361344537815126, 0.008403361344537815, -0.025210084033613446, -0.05042016806722689, -0.058823529411764705, -0.06722689075630252, -0.06722689075630252, -0.06722689075630252, -0.058823529411764705, -0.058823529411764705, -0.06722689075630252, -0.07563025210084033, -0.09243697478991597, -0.10084033613445378, -0.11764705882352941, -0.13445378151260504, -0.13445378151260504, -0.13445378151260504, -0.13445378151260504, -0.12605042016806722, -0.11764705882352941, -0.11764705882352941, -0.11764705882352941, -0.12605042016806722, -0.13445378151260504, -0.14285714285714285, -0.15126050420168066, -0.15966386554621848, -0.15966386554621848, -0.15126050420168066, -0.14285714285714285, -0.13445378151260504, -0.12605042016806722, -0.12605042016806722, -0.11764705882352941, -0.1092436974789916, -0.1092436974789916, -0.11764705882352941, -0.11764705882352941, -0.12605042016806722, -0.13445378151260504, -0.14285714285714285, -0.14285714285714285, -0.14285714285714285, -0.14285714285714285, -0.14285714285714285, -0.13445378151260504, -0.12605042016806722, -0.1092436974789916, -0.10084033613445378, -0.09243697478991597, -0.09243697478991597, -0.08403361344537816, -0.09243697478991597, -0.09243697478991597, -0.10084033613445378, -0.1092436974789916, -0.11764705882352941, -0.12605042016806722, -0.12605042016806722, -0.13445378151260504, -0.12605042016806722, -0.11764705882352941, -0.08403361344537816, -0.04201680672268908, 0.025210084033613446, 0.1092436974789916, 0.2184873949579832, 0.35294117647058826, 0.48739495798319327, 0.6302521008403361, 0.7563025210084033, 0.8487394957983193, 0.907563025210084, 0.907563025210084, 0.8571428571428571, 0.7563025210084033, 0.6050420168067226, 0.42857142857142855, 0.23529411764705882, 0.05042016806722689, -0.11764705882352941, -0.25210084033613445, -0.3445378151260504, -0.40336134453781514, -0.42857142857142855, -0.42016806722689076, -0.3949579831932773, -0.36134453781512604, -0.3277310924369748, -0.29411764705882354, -0.2605042016806723, -0.23529411764705882, -0.21008403361344538, -0.19327731092436976, -0.16806722689075632, -0.15126050420168066, -0.13445378151260504, -0.12605042016806722, -0.11764705882352941, -0.1092436974789916, -0.1092436974789916, -0.1092436974789916, -0.10084033613445378, -0.09243697478991597, -0.07563025210084033, -0.06722689075630252, -0.05042016806722689, -0.03361344537815126, -0.03361344537815126, -0.03361344537815126, -0.04201680672268908, -0.058823529411764705, -0.07563025210084033, -0.10084033613445378, -0.1092436974789916, -0.11764705882352941, -0.1092436974789916, -0.09243697478991597, -0.07563025210084033, -0.058823529411764705, -0.03361344537815126, -0.025210084033613446, -0.01680672268907563, -0.025210084033613446, -0.03361344537815126, -0.05042016806722689, -0.06722689075630252, -0.08403361344537816, -0.10084033613445378, -0.10084033613445378, -0.10084033613445378, -0.09243697478991597, -0.08403361344537816, -0.06722689075630252, -0.058823529411764705, -0.04201680672268908, -0.03361344537815126, -0.025210084033613446, -0.01680672268907563, -0.008403361344537815, -0.008403361344537815, -0.008403361344537815, -0.008403361344537815, -0.008403361344537815, -0.008403361344537815, -0.008403361344537815, 0.0, 0.0, 0.0, 0.0, 0.008403361344537815, 0.01680672268907563, 0.025210084033613446, 0.04201680672268908, 0.058823529411764705, 0.08403361344537816, 0.09243697478991597, 0.1092436974789916, 0.1092436974789916, 0.11764705882352941, 0.11764705882352941, 0.11764705882352941, 0.11764705882352941, 0.13445378151260504, 0.15126050420168066, 0.16806722689075632, 0.18487394957983194, 0.21008403361344538, 0.226890756302521, 0.23529411764705882, 0.24369747899159663, 0.24369747899159663, 0.24369747899159663, 0.25210084033613445, 0.2605042016806723, 0.2689075630252101, 0.2857142857142857, 0.31092436974789917, 0.3277310924369748, 0.33613445378151263, 0.3445378151260504, 0.35294117647058826, 0.3445378151260504, 0.3445378151260504, 0.3445378151260504, 0.3445378151260504, 0.35294117647058826, 0.3697478991596639, 0.37815126050420167, 0.3949579831932773, 0.3949579831932773, 0.3865546218487395, 0.3697478991596639, 0.33613445378151263, 0.29411764705882354, 0.2605042016806723, 0.2184873949579832, 0.19327731092436976, 0.17647058823529413, 0.16806722689075632, 0.15966386554621848, 0.16806722689075632, 0.16806722689075632, 0.15966386554621848, 0.15126050420168066, 0.13445378151260504, 0.11764705882352941, 0.09243697478991597, 0.06722689075630252, 0.05042016806722689, 0.03361344537815126, 0.025210084033613446, 0.008403361344537815, 0.0, -0.01680672268907563, -0.025210084033613446, -0.03361344537815126, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.04201680672268908, -0.03361344537815126, -0.025210084033613446, -0.01680672268907563, -0.01680672268907563, -0.01680672268907563, -0.03361344537815126, -0.04201680672268908, -0.058823529411764705, -0.06722689075630252, -0.07563025210084033, -0.08403361344537816, -0.08403361344537816, -0.08403361344537816, -0.08403361344537816, -0.07563025210084033, -0.07563025210084033, -0.06722689075630252, -0.06722689075630252, -0.058823529411764705, -0.05042016806722689, -0.04201680672268908, -0.03361344537815126, -0.03361344537815126, -0.03361344537815126, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.06722689075630252, -0.07563025210084033, -0.08403361344537816, -0.08403361344537816, -0.07563025210084033, -0.058823529411764705, -0.04201680672268908, -0.025210084033613446, -0.008403361344537815, 0.0, 0.0, -0.008403361344537815, -0.01680672268907563, -0.03361344537815126, -0.05042016806722689, -0.058823529411764705, -0.06722689075630252, -0.06722689075630252, -0.058823529411764705, -0.05042016806722689, -0.04201680672268908, -0.03361344537815126, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.025210084033613446, -0.03361344537815126, -0.03361344537815126, -0.03361344537815126, -0.03361344537815126, -0.03361344537815126, -0.025210084033613446, -0.025210084033613446, -0.03361344537815126, -0.04201680672268908, -0.058823529411764705, -0.06722689075630252, -0.07563025210084033, -0.08403361344537816, -0.08403361344537816, -0.06722689075630252, -0.05042016806722689, -0.03361344537815126, -0.01680672268907563, -0.008403361344537815, -0.008403361344537815, -0.01680672268907563, -0.025210084033613446, -0.04201680672268908, -0.058823529411764705, -0.06722689075630252, -0.06722689075630252, -0.06722689075630252, -0.058823529411764705, -0.04201680672268908, -0.03361344537815126, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.058823529411764705, -0.07563025210084033, -0.08403361344537816, -0.08403361344537816, -0.07563025210084033, -0.06722689075630252, -0.058823529411764705, -0.05042016806722689, -0.05042016806722689, -0.058823529411764705, -0.06722689075630252, -0.07563025210084033, -0.08403361344537816, -0.08403361344537816, -0.07563025210084033, -0.058823529411764705, -0.04201680672268908, -0.01680672268907563, 0.008403361344537815, 0.025210084033613446, 0.03361344537815126, 0.03361344537815126, 0.025210084033613446, 0.008403361344537815, 0.0, -0.008403361344537815, -0.01680672268907563, -0.008403361344537815, 0.008403361344537815, 0.025210084033613446, 0.05042016806722689, 0.06722689075630252, 0.08403361344537816, 0.09243697478991597, 0.10084033613445378, 0.09243697478991597, 0.07563025210084033, 0.05042016806722689, 0.025210084033613446, -0.008403361344537815, -0.025210084033613446, -0.04201680672268908, -0.058823529411764705, -0.06722689075630252, -0.06722689075630252, -0.06722689075630252, -0.06722689075630252, -0.06722689075630252, -0.07563025210084033, -0.08403361344537816, -0.09243697478991597, -0.1092436974789916, -0.11764705882352941, -0.12605042016806722, -0.13445378151260504, -0.13445378151260504, -0.12605042016806722, -0.12605042016806722, -0.12605042016806722, -0.12605042016806722, -0.12605042016806722, -0.12605042016806722, -0.12605042016806722, -0.12605042016806722, -0.12605042016806722, -0.11764705882352941, -0.11764705882352941, -0.1092436974789916, -0.10084033613445378, -0.10084033613445378, -0.1092436974789916, -0.11764705882352941, -0.13445378151260504, -0.15126050420168066, -0.16806722689075632, -0.17647058823529413, -0.17647058823529413, -0.16806722689075632, -0.15126050420168066, -0.13445378151260504, -0.1092436974789916, -0.09243697478991597, -0.07563025210084033, -0.07563025210084033, -0.07563025210084033, -0.08403361344537816, -0.10084033613445378, -0.1092436974789916, -0.11764705882352941, -0.12605042016806722, -0.13445378151260504, -0.13445378151260504, -0.12605042016806722, -0.12605042016806722, -0.12605042016806722, -0.12605042016806722, -0.12605042016806722, -0.12605042016806722, -0.11764705882352941, -0.10084033613445378, -0.07563025210084033, -0.03361344537815126, 0.025210084033613446, 0.09243697478991597, 0.18487394957983194, 0.2773109243697479, 0.3949579831932773, 0.5042016806722689, 0.6218487394957983, 0.7226890756302521, 0.8151260504201681, 0.865546218487395, 0.8739495798319328, 0.8403361344537815, 0.7563025210084033, 0.6218487394957983, 0.453781512605042, 0.25210084033613445, 0.05042016806722689, -0.14285714285714285, -0.31092436974789917, -0.42857142857142855, -0.4957983193277311, -0.5126050420168067, -0.4957983193277311, -0.4369747899159664, -0.36134453781512604, -0.2857142857142857, -0.226890756302521, -0.17647058823529413, -0.14285714285714285, -0.14285714285714285, -0.14285714285714285, -0.15966386554621848, -0.18487394957983194, -0.20168067226890757, -0.21008403361344538, -0.21008403361344538, -0.20168067226890757, -0.19327731092436976, -0.17647058823529413, -0.15126050420168066, -0.13445378151260504, -0.1092436974789916, -0.08403361344537816, -0.06722689075630252, -0.05042016806722689, -0.04201680672268908, -0.03361344537815126, -0.03361344537815126, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.06722689075630252, -0.07563025210084033, -0.08403361344537816, -0.09243697478991597, -0.10084033613445378, -0.09243697478991597, -0.09243697478991597, -0.08403361344537816, -0.07563025210084033, -0.06722689075630252, -0.058823529411764705, -0.05042016806722689, -0.05042016806722689, -0.058823529411764705, -0.058823529411764705, -0.058823529411764705, -0.06722689075630252, -0.058823529411764705, -0.058823529411764705, -0.05042016806722689, -0.04201680672268908, -0.03361344537815126, -0.03361344537815126, -0.03361344537815126, -0.04201680672268908, -0.058823529411764705, -0.06722689075630252, -0.08403361344537816, -0.09243697478991597, -0.09243697478991597, -0.08403361344537816, -0.058823529411764705, -0.025210084033613446, 0.01680672268907563, 0.058823529411764705, 0.10084033613445378, 0.12605042016806722, 0.14285714285714285, 0.14285714285714285, 0.13445378151260504, 0.1092436974789916, 0.07563025210084033, 0.058823529411764705, 0.04201680672268908, 0.04201680672268908, 0.058823529411764705, 0.08403361344537816, 0.11764705882352941, 0.15126050420168066, 0.18487394957983194, 0.21008403361344538, 0.2184873949579832, 0.226890756302521, 0.226890756302521, 0.23529411764705882, 0.23529411764705882, 0.25210084033613445, 0.2689075630252101, 0.29411764705882354, 0.31932773109243695, 0.33613445378151263, 0.3445378151260504, 0.3445378151260504, 0.3277310924369748, 0.31092436974789917, 0.29411764705882354, 0.2773109243697479, 0.2773109243697479, 0.2857142857142857, 0.3025210084033613, 0.3277310924369748, 0.36134453781512604, 0.3865546218487395, 0.40336134453781514, 0.4117647058823529, 0.40336134453781514, 0.3865546218487395, 0.35294117647058826, 0.31932773109243695, 0.2773109243697479, 0.24369747899159663, 0.21008403361344538, 0.18487394957983194, 0.16806722689075632, 0.15126050420168066, 0.14285714285714285, 0.14285714285714285, 0.13445378151260504, 0.13445378151260504, 0.12605042016806722, 0.11764705882352941, 0.1092436974789916, 0.10084033613445378, 0.08403361344537816, 0.058823529411764705, 0.04201680672268908, 0.025210084033613446, 0.0, -0.01680672268907563, -0.04201680672268908, -0.058823529411764705, -0.06722689075630252, -0.08403361344537816, -0.08403361344537816, -0.09243697478991597, -0.09243697478991597, -0.08403361344537816, -0.07563025210084033, -0.06722689075630252, -0.058823529411764705, -0.05042016806722689, -0.05042016806722689, -0.05042016806722689, -0.058823529411764705, -0.07563025210084033, -0.09243697478991597, -0.10084033613445378, -0.1092436974789916, -0.1092436974789916, -0.10084033613445378, -0.09243697478991597, -0.06722689075630252, -0.05042016806722689, -0.03361344537815126, -0.025210084033613446, -0.025210084033613446, -0.04201680672268908, -0.058823529411764705, -0.07563025210084033, -0.09243697478991597, -0.10084033613445378, -0.10084033613445378, -0.10084033613445378, -0.08403361344537816, -0.06722689075630252, -0.058823529411764705, -0.04201680672268908, -0.04201680672268908, -0.05042016806722689, -0.06722689075630252, -0.08403361344537816, -0.10084033613445378, -0.1092436974789916, -0.11764705882352941, -0.11764705882352941, -0.10084033613445378, -0.08403361344537816, -0.06722689075630252, -0.05042016806722689, -0.03361344537815126, -0.025210084033613446, -0.025210084033613446, -0.03361344537815126, -0.04201680672268908, -0.05042016806722689, -0.06722689075630252, -0.06722689075630252, -0.07563025210084033, -0.06722689075630252, -0.06722689075630252, -0.05042016806722689, -0.04201680672268908, -0.03361344537815126, -0.025210084033613446, -0.01680672268907563, -0.01680672268907563, -0.01680672268907563, -0.025210084033613446, -0.03361344537815126, -0.04201680672268908, -0.058823529411764705, -0.07563025210084033, -0.09243697478991597, -0.1092436974789916, -0.12605042016806722, -0.13445378151260504, -0.14285714285714285, -0.14285714285714285, -0.14285714285714285, -0.12605042016806722, -0.1092436974789916, -0.09243697478991597, -0.07563025210084033, -0.058823529411764705, -0.04201680672268908, -0.04201680672268908, -0.04201680672268908, -0.04201680672268908, -0.04201680672268908, -0.04201680672268908, -0.04201680672268908, -0.03361344537815126, -0.01680672268907563, 0.0, 0.008403361344537815, 0.01680672268907563, 0.025210084033613446, 0.01680672268907563, 0.008403361344537815, 0.0, -0.008403361344537815, -0.008403361344537815, -0.008403361344537815, 0.0, 0.008403361344537815, 0.025210084033613446, 0.03361344537815126, 0.04201680672268908, 0.05042016806722689, 0.05042016806722689, 0.04201680672268908, 0.03361344537815126, 0.025210084033613446, 0.01680672268907563, 0.0, -0.008403361344537815, -0.025210084033613446, -0.03361344537815126, -0.05042016806722689, -0.058823529411764705, -0.058823529411764705, -0.06722689075630252, -0.07563025210084033, -0.08403361344537816, -0.09243697478991597, -0.10084033613445378, -0.1092436974789916, -0.12605042016806722, -0.13445378151260504, -0.14285714285714285, -0.15126050420168066, -0.15126050420168066, -0.15126050420168066, -0.14285714285714285, -0.14285714285714285, -0.13445378151260504, -0.13445378151260504, -0.13445378151260504, -0.14285714285714285, -0.15126050420168066, -0.15966386554621848, -0.16806722689075632, -0.16806722689075632, -0.16806722689075632, -0.15126050420168066, -0.13445378151260504, -0.11764705882352941, -0.10084033613445378, -0.08403361344537816, -0.07563025210084033, -0.08403361344537816, -0.09243697478991597, -0.1092436974789916, -0.12605042016806722, -0.14285714285714285, -0.15966386554621848, -0.17647058823529413, -0.17647058823529413, -0.17647058823529413, -0.16806722689075632, -0.15966386554621848, -0.14285714285714285, -0.12605042016806722, -0.11764705882352941, -0.11764705882352941, -0.11764705882352941, -0.12605042016806722, -0.14285714285714285, -0.15126050420168066, -0.15966386554621848, -0.15966386554621848, -0.15126050420168066, -0.12605042016806722, -0.10084033613445378, -0.058823529411764705, -0.025210084033613446, 0.008403361344537815, 0.04201680672268908, 0.07563025210084033, 0.1092436974789916, 0.15966386554621848, 0.226890756302521, 0.3277310924369748, 0.44537815126050423, 0.5714285714285714, 0.6974789915966386, 0.8067226890756303, 0.865546218487395, 0.865546218487395, 0.7899159663865546, 0.6554621848739496, 0.47058823529411764, 0.25210084033613445, 0.025210084033613446, -0.17647058823529413, -0.33613445378151263, -0.44537815126050423] # Replace with your actual initial data



predicted_points = iterative_forecast(initial_points, model, steps=500)

# Plotting
plt.figure(figsize=(12, 6))
plt.plot(range(1600), initial_points, label='Initial Data')
plt.plot(range(1600, 2100), predicted_points[1600:], label='Predicted Data')
plt.title("ECG Signal Forecasting")
plt.xlabel("Time Steps")
plt.ylabel("ECG Signal Value")
plt.legend()
plt.show()